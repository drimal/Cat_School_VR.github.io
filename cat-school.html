<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <meta name="theme-color" content="#1a0000">
  <title>Cat School VR - Horror Escape</title>
  <style>
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      -webkit-user-select: none;
      user-select: none;
    }
    
    body {
      overflow: hidden;
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
      background: #000;
      touch-action: none;
    }
    
    #container {
      width: 100vw;
      height: 100vh;
      position: relative;
    }
    
    #hud {
      position: absolute;
      top: 16px;
      left: 16px;
      background: rgba(0,0,0,0.7);
      color: white;
      padding: 16px;
      border-radius: 8px;
      z-index: 10;
      backdrop-filter: blur(10px);
    }
    
    @keyframes pulse {
      0%, 100% { opacity: 1; }
      50% { opacity: 0.8; }
    }
    
    @keyframes explosiveJump { 
      0% { transform: scale(0.01); opacity: 0; } 
      70% { transform: scale(1.2); } 
      100% { transform: scale(1); opacity: 1; } 
    }
    
    @keyframes flash { 
      0%, 50% { background: black; } 
      25%, 75% { background: #8B0000; } 
    }
    
    @keyframes shake { 
      0%, 100% { transform: translate(0, 0); } 
      25% { transform: translate(-15px, 10px) rotate(-3deg); } 
      75% { transform: translate(15px, -10px) rotate(3deg); } 
    }
  </style>
</head>
<body>
  <div id="container"></div>
  <div id="hud">
    <div style="font-size: 24px; font-weight: bold;">Time: <span id="time">0</span>s</div>
    <div style="font-size: 14px; margin-top: 8px;">WASD or Arrow Keys</div>
    <div style="font-size: 14px; color: #ffeb3b;">Climb to escape!</div>
    <div style="font-size: 14px; color: #88ff88; margin-top: 4px;">Press F for Flashlight üî¶</div>
    <div style="font-size: 14px; color: #ff6666; font-weight: bold; margin-top: 4px; animation: pulse 1s infinite;">
      ‚ö†Ô∏è NIGHTMARE APPROACHING! ‚ö†Ô∏è
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
  <script>
    var container = document.getElementById('container');
    var timeDisplay = document.getElementById('time');
    var survivalTime = 0;
    var startTime = Date.now();

    var config = {
      playerSpeed: 0.25,
      bullySpeed: 0.12,
      bullyCount: 1000,
      playgroundSize: 60
    };

    var scene = new THREE.Scene();
    scene.background = new THREE.Color(0x1a0000);
    scene.fog = new THREE.Fog(0x1a0000, 20, 50);

    var camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
    var renderer = new THREE.WebGLRenderer({ antialias: true });
    renderer.setSize(window.innerWidth, window.innerHeight);
    renderer.shadowMap.enabled = true;
    container.appendChild(renderer.domElement);

    var ambientLight = new THREE.AmbientLight(0xffffff, 0.1);
    scene.add(ambientLight);

    var sunLight = new THREE.DirectionalLight(0xff0000, 0.3);
    sunLight.position.set(30, 60, 30);
    sunLight.castShadow = true;
    scene.add(sunLight);

    var ground = new THREE.Mesh(
      new THREE.PlaneGeometry(config.playgroundSize * 2, config.playgroundSize * 2),
      new THREE.MeshLambertMaterial({ color: 0x1a1a1a })
    );
    ground.rotation.x = -Math.PI / 2;
    ground.receiveShadow = true;
    scene.add(ground);

    function createCat(color, isPlayer) {
      var cat = new THREE.Group();
      var body = new THREE.Mesh(
        new THREE.BoxGeometry(0.8, 0.5, 1.2),
        new THREE.MeshLambertMaterial({ color: color })
      );
      body.position.y = 0.5;
      body.castShadow = true;
      cat.add(body);

      var head = new THREE.Mesh(
        new THREE.SphereGeometry(0.4, 16, 16),
        new THREE.MeshLambertMaterial({ color: color })
      );
      head.position.set(0, 0.7, 0.7);
      head.castShadow = true;
      cat.add(head);

      var eyeMaterial = new THREE.MeshBasicMaterial({ 
        color: isPlayer ? 0x000000 : 0xFF0000,
        emissive: isPlayer ? 0x000000 : 0xFF0000,
        emissiveIntensity: isPlayer ? 0 : 2
      });
      
      var leftEye = new THREE.Mesh(new THREE.SphereGeometry(0.08, 8, 8), eyeMaterial);
      leftEye.position.set(-0.15, 0.75, 1);
      cat.add(leftEye);

      var rightEye = new THREE.Mesh(new THREE.SphereGeometry(0.08, 8, 8), eyeMaterial);
      rightEye.position.set(0.15, 0.75, 1);
      cat.add(rightEye);

      return cat;
    }

    var player = createCat(0xFF8C00, true);
    player.position.set(0, 0, 0);
    scene.add(player);

    var flashlight = new THREE.SpotLight(0xffffaa, 2, 50, Math.PI / 6, 0.5, 1);
    flashlight.position.set(0, 1, 0);
    flashlight.castShadow = true;
    player.add(flashlight);
    
    var flashlightTarget = new THREE.Object3D();
    flashlightTarget.position.set(0, 0, 5);
    player.add(flashlightTarget);
    flashlight.target = flashlightTarget;

    var bullies = [];
    
    for (var i = 0; i < config.bullyCount; i++) {
      var bully;
      
      if (i === 0) {
        bully = createCat(0x000000, false);
        bully.scale.set(12, 12, 12);
        bully.position.set(-45, 0, 0);
        
        var aura1 = new THREE.PointLight(0x8B00FF, 8, 40);
        aura1.position.set(0, 4, 0);
        bully.add(aura1);
        
        var aura2 = new THREE.PointLight(0xFF0000, 6, 30);
        aura2.position.set(0, 0, 0);
        bully.add(aura2);
      } else {
        var x = -50 - Math.random() * 30;
        var z = -60 + Math.random() * 120;
        bully = createCat(0x333333, false);
        bully.position.set(x, 0, z);
      }
      
      scene.add(bully);
      bullies.push(bully);
    }

    var climbableAreas = [
      { x: -25, z: 25, y: 8, radius: 3 },
      { x: 25, z: 25, y: 12, radius: 5.5 }
    ];

    var slideBase = new THREE.Mesh(
      new THREE.BoxGeometry(8, 0.5, 8),
      new THREE.MeshLambertMaterial({ color: 0x660000 })
    );
    slideBase.position.set(-25, 0.25, 25);
    slideBase.castShadow = true;
    scene.add(slideBase);

    var slidePlatform = new THREE.Mesh(
      new THREE.BoxGeometry(6, 0.3, 6),
      new THREE.MeshLambertMaterial({ color: 0x660000 })
    );
    slidePlatform.position.set(-25, 8, 25);
    slidePlatform.castShadow = true;
    scene.add(slidePlatform);

    camera.position.set(0, 12, 12);
    camera.lookAt(player.position);

    var keys = { w: false, a: false, s: false, d: false };
    var flashlightOn = true;
    
    window.addEventListener('keydown', function(e) {
      var key = e.key.toLowerCase();
      if (keys.hasOwnProperty(key)) keys[key] = true;
      if (e.key === 'ArrowUp') keys.w = true;
      if (e.key === 'ArrowDown') keys.s = true;
      if (e.key === 'ArrowLeft') keys.a = true;
      if (e.key === 'ArrowRight') keys.d = true;
      
      if (key === 'f') {
        flashlightOn = !flashlightOn;
        flashlight.intensity = flashlightOn ? 2 : 0;
      }
    });

    window.addEventListener('keyup', function(e) {
      var key = e.key.toLowerCase();
      if (keys.hasOwnProperty(key)) keys[key] = false;
      if (e.key === 'ArrowUp') keys.w = false;
      if (e.key === 'ArrowDown') keys.s = false;
      if (e.key === 'ArrowLeft') keys.a = false;
      if (e.key === 'ArrowRight') keys.d = false;
    });

    var isPlaying = true;

    function checkClimbable(x, z) {
      for (var i = 0; i < climbableAreas.length; i++) {
        var area = climbableAreas[i];
        var dist = Math.sqrt((x - area.x) * (x - area.x) + (z - area.z) * (z - area.z));
        if (dist < area.radius) return area.y;
      }
      return 0;
    }

    function showJumpscare() {
      var jumpscare = document.createElement('div');
      jumpscare.innerHTML = '<div style="position: fixed; inset: 0; z-index: 1000;"><div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center; animation: explosiveJump 0.15s;"><div style="width: 120vw; height: 120vh; background: radial-gradient(circle, #330000 0%, #000000 100%); display: flex; align-items: center; justify-content: center;"><div style="width: 600px; height: 700px; position: relative;"><div style="position: absolute; width: 400px; height: 500px; top: 50%; left: 50%; transform: translate(-50%, -50%); background: #0a0a0a; border-radius: 50% 50% 30% 30%; border: 5px solid #FF0000; box-shadow: inset 0 0 100px rgba(255,0,0,0.8);"><div style="position: absolute; top: 120px; left: 60px; width: 90px; height: 120px; background: radial-gradient(circle, #000000 30%, #1a0000 100%); border-radius: 50%;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: #FF0000; border-radius: 50%; box-shadow: 0 0 40px #ff0000;"></div></div><div style="position: absolute; top: 120px; right: 60px; width: 90px; height: 120px; background: radial-gradient(circle, #000000 30%, #1a0000 100%); border-radius: 50%;"><div style="position: absolute; top: 50%; left: 50%; transform: translate(-50%, -50%); width: 40px; height: 40px; background: #FF0000; border-radius: 50%; box-shadow: 0 0 40px #ff0000;"></div></div><div style="position: absolute; bottom: 60px; left: 50%; transform: translateX(-50%); width: 220px; height: 180px; background: #000000; border-radius: 50%; border: 4px solid #8B0000;"></div></div></div></div></div><div style="position: absolute; inset: 0; background: black; animation: flash 0.08s infinite; z-index: -1;"></div><div style="position: absolute; inset: 0; display: flex; align-items: center; justify-content: center;"><div style="font-size: 120px; font-weight: bold; color: #FF0000; text-shadow: 0 0 20px #ff0000, 0 0 40px #ff0000, 10px 10px 0 #000; animation: shake 0.08s infinite;">YOU DIED</div></div><div style="position: absolute; bottom: 80px; left: 50%; transform: translateX(-50%);"><div style="background: black; padding: 32px; border-radius: 8px; text-align: center; border: 6px solid #8B0000; box-shadow: 0 0 60px rgba(255,0,0,0.9);"><h2 style="font-size: 48px; font-weight: bold; margin-bottom: 16px; color: #FF0000;">GAME OVER</h2><p style="font-size: 32px; margin-bottom: 24px; color: #ff6666; font-weight: bold;">Survived: ' + survivalTime + ' seconds</p><button onclick="location.reload()" style="background: #8B0000; color: white; font-weight: bold; padding: 16px 48px; border-radius: 8px; font-size: 24px; border: 3px solid #FF0000; cursor: pointer;">PLAY AGAIN</button></div></div></div>';
      document.body.appendChild(jumpscare);
    }

    function animate() {
      if (!isPlaying) return;
      requestAnimationFrame(animate);

      var oldX = player.position.x;
      var oldZ = player.position.z;

      if (keys.w) player.position.z -= config.playerSpeed;
      if (keys.s) player.position.z += config.playerSpeed;
      if (keys.a) player.position.x -= config.playerSpeed;
      if (keys.d) player.position.x += config.playerSpeed;

      if (Math.abs(player.position.x) > config.playgroundSize || Math.abs(player.position.z) > config.playgroundSize) {
        player.position.x = oldX;
        player.position.z = oldZ;
      }

      var targetHeight = checkClimbable(player.position.x, player.position.z);
      player.position.y += (targetHeight - player.position.y) * 0.1;

      if (oldX !== player.position.x || oldZ !== player.position.z) {
        player.rotation.y = Math.atan2(player.position.x - oldX, player.position.z - oldZ);
      }

      for (var i = 0; i < bullies.length; i++) {
        var bully = bullies[i];
        var dx = player.position.x - bully.position.x;
        var dz = player.position.z - bully.position.z;
        var distance = Math.sqrt(dx * dx + dz * dz);

        if (distance > 0.1) {
          bully.position.x += (dx / distance) * config.bullySpeed;
          bully.position.z += (dz / distance) * config.bullySpeed;
          bully.rotation.y = Math.atan2(dx, dz);
          bully.position.y = Math.sin(Date.now() * 0.01 + i) * 0.1;
        }

        var heightDiff = Math.abs(player.position.y - bully.position.y);
        if (distance < 1.5 && heightDiff < 2) {
          isPlaying = false;
          
          if (i === 0) {
            camera.position.set(bully.position.x + 1, bully.position.y + 4, bully.position.z + 2);
            camera.lookAt(bully.position.x, bully.position.y + 3, bully.position.z);
            bully.scale.set(20, 20, 20);
          }
          
          try {
            var ctx = new (window.AudioContext || window.webkitAudioContext)();
            var osc = ctx.createOscillator();
            var gain = ctx.createGain();
            osc.connect(gain);
            gain.connect(ctx.destination);
            osc.frequency.setValueAtTime(100, ctx.currentTime);
            osc.frequency.exponentialRampToValueAtTime(800, ctx.currentTime + 0.5);
            osc.type = 'sawtooth';
            gain.gain.setValueAtTime(0.5, ctx.currentTime);
            gain.gain.exponentialRampToValueAtTime(0.01, ctx.currentTime + 1);
            osc.start();
            osc.stop(ctx.currentTime + 1);
          } catch (e) {}
          
          if (navigator.vibrate) navigator.vibrate([200, 100, 200, 100, 500]);
          
          showJumpscare();
        }
      }

      camera.position.x = player.position.x;
      camera.position.y = player.position.y + 12;
      camera.position.z = player.position.z + 12;
      camera.lookAt(new THREE.Vector3(player.position.x, player.position.y, player.position.z));

      survivalTime = Math.floor((Date.now() - startTime) / 1000);
      timeDisplay.textContent = survivalTime;
      renderer.render(scene, camera);
    }

    animate();

    window.addEventListener('resize', function() {
      camera.aspect = window.innerWidth / window.innerHeight;
      camera.updateProjectionMatrix();
      renderer.setSize(window.innerWidth, window.innerHeight);
    });
  </script>
</body>
</html>